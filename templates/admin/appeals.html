{% extends "admin/base.html" %}
{% block title %}Споры и апелляции{% endblock %}
{% block content %}
<div class="card">
  <h2>Апелляции</h2>
  <form method="get">
    <select name="status">
      <option value="">Все статусы</option>
      <option value="pending_company_response" {% if status == 'pending_company_response' %}selected{% endif %}>Ожидает компанию</option>
      <option value="pending_admin_review" {% if status == 'pending_admin_review' %}selected{% endif %}>Ожидает модератора</option>
      <option value="approved" {% if status == 'approved' %}selected{% endif %}>Одобрено</option>
      <option value="rejected" {% if status == 'rejected' %}selected{% endif %}>Отклонено</option>
      <option value="deleted" {% if status == 'deleted' %}selected{% endif %}>Удалено</option>
    </select>
    <button type="submit">Фильтр</button>
  </form>
</div>
<div class="card">
  <table>
    <tr>
      <th>ID</th>
      <th>Исполнитель</th>
      <th>Компания</th>
      <th>Статус</th>
      <th>Комментарий исполнителя</th>
      <th>Комментарий компании</th>
      <th>Решение</th>
    </tr>
    {% for appeal in appeals %}
      <tr>
        <td>{{ appeal.id }}</td>
        <td>{{ appeal.master_full_name }} ({{ appeal.master_public_id }})</td>
        <td>{{ appeal.company_name or '-' }} ({{ appeal.company_public_id or '-' }})</td>
        <td>{{ appeal.status }}</td>
        <td>{{ appeal.master_comment or '-' }}</td>
        <td>{{ appeal.company_comment or '-' }}</td>
        <td>
          {% if 'appeals.resolve' in g.permissions %}
          <form method="post" action="{{ url_for('admin_appeals_decision', appeal_id=appeal.id) }}">
            <select name="status" required>
              <option value="approved">Одобрить</option>
              <option value="rejected">Отклонить</option>
              <option value="deleted">Удалить отзыв</option>
            </select>
            <input type="text" name="admin_comment" placeholder="Комментарий" />
            <button type="submit">Сохранить</button>
          </form>
          {% else %}
            {{ appeal.admin_comment or '-' }}
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </table>
</div>
{% endblock %}
